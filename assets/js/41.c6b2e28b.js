(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{212:function(t,e,s){"use strict";s.r(e);var a=s(0),i=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"tips-for-writing-security-rules"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tips-for-writing-security-rules"}},[t._v("#")]),t._v(" Tips for writing Security Rules")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Tip 01")]),t._v(" "),s("p",[t._v("If the type is defined in the schema ("),s("code",[t._v('bolt_validation_type: "ChildType[]"')]),t._v("),\nthen it can and should not be defined via path "),s("code",[t._v("/path/to/child")])])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Tip 02")]),t._v(" "),s("p",[t._v("read/write rules can also be defined in "),s("code",[t._v("schema.bolt")]),t._v(".\nIn some cases, this might even be necessary! (see sequence)")])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Tip 03")]),t._v(" "),s("p",[t._v("Path in "),s("code",[t._v("/path/xx")]),t._v(" as "),s("code",[t._v("MyType[]")]),t._v(" should never end with an {id}!")])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Tip 04")]),t._v(" "),s("p",[t._v("Be careful when using "),s("strong",[t._v("white spaces")]),t._v(". Tabs in "),s("code",[t._v(".bolt")]),t._v(" files will cause errors and are very hard to find.")])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Tip 05")]),t._v(" "),s("p",[t._v('Nested read/write rules are connected via "OR"\nYou cannot grant access to data, then revoke it later!')])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Tip 06")]),t._v(" "),s("p",[t._v("No "),s("code",[t._v("read()/write() = false")])])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Tip 07")]),t._v(" "),s("p",[s("code",[t._v("read() { false }")]),t._v(" = "),s("code",[t._v("read() {}")]),t._v(" = no read (same for write)")])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Tip 08")]),t._v(" "),s("p",[s("code",[t._v("write = create + update + delete")])])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Tip 09")]),t._v(" "),s("p",[t._v("Create overwrite write when write is false and create is true (?)")])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Tip 10")]),t._v(" "),s("p",[t._v("Multiple "),s("code",[t._v("update()")]),t._v(" are not allowed, use "),s("code",[t._v("||")]),t._v(" instead.")])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Tip 11")]),t._v(" "),s("p",[t._v("Validation rules do not cascade, so all relevant validation rules must evaluate\nto true in order for the write to be allowed.")])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Tip 12")]),t._v(" "),s("p",[t._v("Object types are required to have at least one property when present.")])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Tip 13")]),t._v(" "),s("p",[t._v("Map types can be empty collections (they don't have to contain any child keys).")])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Tip 14")]),t._v(" "),s("p",[t._v("First letters of type definitions must be "),s("strong",[t._v("uppercase")]),t._v(" and should be "),s("strong",[t._v("singular")]),t._v(".")])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Tip 15")]),t._v(" "),s("p",[s("code",[t._v("index()")]),t._v(" is the index for props of EVERY child, not the node itself!")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("path /x { index() ['prop'] }\n")])])]),s("p",[t._v("means "),s("code",[t._v("/x/1/prop")]),t._v(" will get indexed")])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Tip 16")]),t._v(" "),s("p",[t._v("When using functions in:\n"),s("code",[t._v("this")]),t._v(" is not available in functions and must be passed to the function as a parameter")])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Tip 17")]),t._v(" "),s("p",[t._v("If queries are used, the child-rules won't work! You have to define\n"),s("code",[t._v("query.*")]),t._v(" rules. ")])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Tip 18")]),t._v(" "),s("p",[t._v('If the bolt compiler complains about duplicate keys ("$taskId" and "$key18"),\nthe reason is probably that\n'),s("code",[t._v("'path /path/task_meta is TaskMeta[]'")]),t._v(" is used in combination with\n"),s("code",[t._v("'path /path/task_meta/{idTaskMeta}/sub is SubItem[]'")]),t._v(", which is currently\nnot possible. TaskMeta type needs to be converted to something like\n"),s("code",[t._v("'sub: { bolt_validation_type: \"SubItem[]\" }'")]),t._v(".")])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Tip 19")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("path /a/b/c is Type[] { write, update, delete, create }\n")])])]),s("p",[t._v("is most likely wrong,\nyou probably want to do")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("path /a/b/c { path /{id} is Type { write, update, ... } }\n")])])])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Tip 20")]),t._v(" "),s("p",[t._v("This is most likely wrong:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("  path /user/{uid}/notifications is Notification[] {\n    read() { isUser(uid) }\n    create() { false }\n    update() { false }\n    delete() { isUser(uid) }\n  }\n")])])]),s("p",[t._v("correct:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("  path /user/{uid}/notifications {\n    read() { isUser(uid) }\n    path /{notificationId} is Notification {\n      create() { false }\n      update() { false }\n      delete() { isUser(uid) }\n    }\n  }\n")])])]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('"outgoing_invitations": {\n  "$invitationId": {\n    ".validate": "newData.hasChildren()",\n    ...\n    ".write": "newData.val() == null"\n  }\n}\n')])])]),s("p",[t._v("vs")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('"outgoing_invitations": {\n  "$key12": {\n    ".validate": "newData.hasChildren()",\n    ...\n  },\n  ".validate": "newData.hasChildren()",\n  ".write": "newData.val() == null"\n}\n')])])]),s("p",[t._v("but this works:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('"incoming_invitations": {\n  "$key12": {\n    ...\n  },\n  ".validate": "newData.hasChildren()",\n  ".write": "((data.val() == null && auth != null) || ((data.val() != null && newData.val() == null) && ((auth != null && auth.uid == $uid) || data.child(\'senderUserId\').val() == auth.uid)))"\n},\n')])])])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Tip 21")]),t._v(" "),s("p",[t._v("If you only get "),s("code",[t._v("PERMISSION_DENIED")]),t._v(" without any other information,\nthe reason can be found by looking at the socket comminucation with\nChrome DevTools (See corresponding request with same r-value as error frame).")])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Tip 22")]),t._v(" "),s("p",[t._v("Shallower security rules override rules at deeper paths. Child rules can only grant\nadditional privileges to what parent nodes have already declared. They cannot revoke a\nread or write privilege.")])]),t._v(" "),s("p",[t._v("For more information see: "),s("a",{attrs:{href:"https://github.com/FirebaseExtended/bolt/blob/master/docs/language.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/FirebaseExtended/bolt/blob/master/docs/language.md"),s("OutboundLink")],1),t._v(".")])])}),[],!1,null,null,null);e.default=i.exports}}]);